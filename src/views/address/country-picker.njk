{% extends "base-form.njk" %}
{% set hmpoPageKey = "countryPicker" %}
{% set hmpoPageContent = "countryPicker" %}
{% set gtmJourney = "address - middle" %}

{% from "hmpo-form/macro.njk" import hmpoForm %}
{% from "hmpo-select/macro.njk" import hmpoSelect %}
{% from "components/analytics/onPageLoad/macro.njk" import ga4OnPageLoad %}

{% block mainContent %}

  {% call hmpoForm(ctx) %}
    <h1 id="header" class="govuk-heading-l">
      <label for="countryPicker">
        {{translate("pages.countryPicker.title")}}
      </label>
    </h1>

    {{ hmpoSelect(ctx, {
      id: "countryPicker",
      label: "",
      hint: "",
      items: countries
    }) }}

    {# <select name="countryPicker" id="countryPicker">
      <option value=""></option>
      {% for country in countries %}
        <option value="{{ country.value }}">{{ translate(country.key) }}</option>
      {% endfor %}
    </select> #}

    {{ hmpoSubmit(ctx, { id: "continue", text: translate("buttons.next"), classes: "govuk-!-margin-top-6" }) }}

  {% endcall %}

  {{ ga4OnPageLoad({
    nonce: cspNonce,
    statusCode: '200',
    englishPageTitle: 'pages.addrescountryPickersSearch.title' | translate,
    taxonomyLevel1: 'web cri',
    taxonomyLevel2: 'address',
    contentId: 'd29ae122-986d-4730-8dac-8798b79f7aba',
    loggedInStatus: true,
    dynamic: false
  }) }}

  <script id="govuk-script-analytics" nonce="{{ cspNonce }}" type="text/javascript"> 
    document.addEventListener('DOMContentLoaded', function() {

      const initialiseAddressCountryAutocomplete = () => {
        var autocompleteScript = document.createElement('script')

        autocompleteScript.onload = function () {
          accessibleAutocomplete.enhanceSelectElement({
            selectElement: document.querySelector('#countryPicker'),
            showAllValues: true,
            dropdownArrow: () => '<svg class="autocomplete__dropdown-arrow-down" style="top: 8px;" viewBox="0 0 512 512"><path d="M256,298.3L256,298.3L256,298.3l174.2-167.2c4.3-4.2,11.4-4.1,15.8,0.2l30.6,29.9c4.4,4.3,4.5,11.3,0.2,15.5L264.1,380.9  c-2.2,2.2-5.2,3.2-8.1,3c-3,0.1-5.9-0.9-8.1-3L35.2,176.7c-4.3-4.2-4.2-11.2,0.2-15.5L66,131.3c4.4-4.3,11.5-4.4,15.8-0.2L256,298.3  z"></path></svg>'
          })
        }

        autocompleteScript.setAttribute('type', 'text/javascript')
        autocompleteScript.setAttribute('src', '/public/javascripts/accessible-autocomplete.min.js')
        document.getElementsByTagName('head')[0].appendChild(autocompleteScript)
      }
      initialiseAddressCountryAutocomplete()
    })
  </script>
{% endblock %}
